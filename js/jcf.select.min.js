!function(a){a.addModule(function(b,c){"use strict";function d(a){this.options=b.extend({wrapNative:!0,wrapNativeOnMobile:!0,fakeDropInBody:!0,useCustomScroll:!0,flipDropToFit:!0,maxVisibleItems:10,fakeAreaStructure:'<span class="jcf-select"><span class="jcf-select-text"></span><span class="jcf-select-opener"></span></span>',fakeDropStructure:'<div class="jcf-select-drop"><div class="jcf-select-drop-content"></div></div>',optionClassPrefix:"jcf-option-",selectClassPrefix:"jcf-select-",dropContentSelector:".jcf-select-drop-content",selectTextSelector:".jcf-select-text",dropActiveClass:"jcf-drop-active",flipDropClass:"jcf-drop-flipped"},a),this.init()}function e(a){this.options=b.extend({wrapNative:!0,useCustomScroll:!0,fakeStructure:'<span class="jcf-list-box"><span class="jcf-list-wrapper"></span></span>',selectClassPrefix:"jcf-select-",listHolder:".jcf-list-wrapper"},a),this.init()}function f(a){this.options=b.extend({holder:null,maxVisibleItems:10,selectOnClick:!0,useHoverClass:!1,useCustomScroll:!1,handleResize:!0,multipleSelectWithoutKey:!1,alwaysPreventMouseWheel:!1,indexAttribute:"data-index",cloneClassPrefix:"jcf-option-",containerStructure:'<span class="jcf-list"><span class="jcf-list-content"></span></span>',containerSelector:".jcf-list-content",captionClass:"jcf-optgroup-caption",disabledClass:"jcf-disabled",optionClass:"jcf-option",groupClass:"jcf-optgroup",hoverClass:"jcf-hover",selectedClass:"jcf-selected",scrollClass:"jcf-scroll-active"},a),this.init()}var g={name:"Select",selector:"select",options:{element:null,multipleCompactStyle:!1},plugins:{ListBox:e,ComboBox:d,SelectList:f},matchElement:function(a){return a.is("select")},init:function(){this.element=b(this.options.element),this.createInstance()},isListBox:function(){return this.element.is("[size]:not([jcf-size]), [multiple]")},createInstance:function(){this.instance&&this.instance.destroy(),this.isListBox()&&!this.options.multipleCompactStyle?this.instance=new e(this.options):this.instance=new d(this.options)},refresh:function(){var a=this.isListBox()&&this.instance instanceof d||!this.isListBox()&&this.instance instanceof e;a?this.createInstance():this.instance.refresh()},destroy:function(){this.instance.destroy()}};b.extend(d.prototype,{init:function(){this.initStructure(),this.bindHandlers(),this.attachEvents(),this.refresh()},initStructure:function(){this.win=b(c),this.doc=b(document),this.realElement=b(this.options.element),this.fakeElement=b(this.options.fakeAreaStructure).insertAfter(this.realElement),this.selectTextContainer=this.fakeElement.find(this.options.selectTextSelector),this.selectText=b("<span></span>").appendTo(this.selectTextContainer),i(this.fakeElement),this.fakeElement.addClass(h(this.realElement.prop("className"),this.options.selectClassPrefix)),this.realElement.prop("multiple")&&this.fakeElement.addClass("jcf-compact-multiple"),this.options.isMobileDevice&&this.options.wrapNativeOnMobile&&!this.options.wrapNative&&(this.options.wrapNative=!0),this.options.wrapNative?this.realElement.prependTo(this.fakeElement).css({position:"absolute",height:"100%",width:"100%"}).addClass(this.options.resetAppearanceClass):(this.realElement.addClass(this.options.hiddenClass),this.fakeElement.attr("title",this.realElement.attr("title")),this.fakeDropTarget=this.options.fakeDropInBody?b("body"):this.fakeElement)},attachEvents:function(){var a=this;this.delayedRefresh=function(){setTimeout(function(){a.refresh(),a.list&&(a.list.refresh(),a.list.scrollToActiveOption())},1)},this.options.wrapNative?this.realElement.on({focus:this.onFocus,change:this.onChange,click:this.onChange,keydown:this.delayedRefresh}):(this.realElement.on({focus:this.onFocus,change:this.onChange,keydown:this.onKeyDown}),this.fakeElement.on({"jcf-pointerdown":this.onSelectAreaPress}))},onKeyDown:function(a){13===a.which?this.toggleDropdown():this.dropActive&&this.delayedRefresh()},onChange:function(){this.refresh()},onFocus:function(){this.pressedFlag&&this.focusedFlag||(this.fakeElement.addClass(this.options.focusClass),this.realElement.on("blur",this.onBlur),this.toggleListMode(!0),this.focusedFlag=!0)},onBlur:function(){this.pressedFlag||(this.fakeElement.removeClass(this.options.focusClass),this.realElement.off("blur",this.onBlur),this.toggleListMode(!1),this.focusedFlag=!1)},onResize:function(){this.dropActive&&this.hideDropdown()},onSelectDropPress:function(){this.pressedFlag=!0},onSelectDropRelease:function(a,b){this.pressedFlag=!1,"mouse"===b.pointerType&&this.realElement.focus()},onSelectAreaPress:function(a){var c=!this.options.fakeDropInBody&&b(a.target).closest(this.dropdown).length;c||a.button>1||this.realElement.is(":disabled")||(this.selectOpenedByEvent=a.pointerType,this.toggleDropdown(),this.focusedFlag||("mouse"===a.pointerType?this.realElement.focus():this.onFocus(a)),this.pressedFlag=!0,this.fakeElement.addClass(this.options.pressedClass),this.doc.on("jcf-pointerup",this.onSelectAreaRelease))},onSelectAreaRelease:function(a){this.focusedFlag&&"mouse"===a.pointerType&&this.realElement.focus(),this.pressedFlag=!1,this.fakeElement.removeClass(this.options.pressedClass),this.doc.off("jcf-pointerup",this.onSelectAreaRelease)},onOutsideClick:function(a){var c=b(a.target),d=c.closest(this.fakeElement).length||c.closest(this.dropdown).length;d||this.hideDropdown()},onSelect:function(){this.refresh(),this.realElement.prop("multiple")?this.repositionDropdown():this.hideDropdown(),this.fireNativeEvent(this.realElement,"change")},toggleListMode:function(a){this.options.wrapNative||(a?this.realElement.attr({size:4,"jcf-size":""}):this.options.wrapNative||this.realElement.removeAttr("size jcf-size"))},createDropdown:function(){this.dropdown&&(this.list.destroy(),this.dropdown.remove()),this.dropdown=b(this.options.fakeDropStructure).appendTo(this.fakeDropTarget),this.dropdown.addClass(h(this.realElement.prop("className"),this.options.selectClassPrefix)),i(this.dropdown),this.realElement.prop("multiple")&&this.dropdown.addClass("jcf-compact-multiple"),this.options.fakeDropInBody&&this.dropdown.css({position:"absolute",top:-9999}),this.list=new f({useHoverClass:!0,handleResize:!1,alwaysPreventMouseWheel:!0,maxVisibleItems:this.options.maxVisibleItems,useCustomScroll:this.options.useCustomScroll,holder:this.dropdown.find(this.options.dropContentSelector),multipleSelectWithoutKey:this.realElement.prop("multiple"),element:this.realElement}),b(this.list).on({select:this.onSelect,press:this.onSelectDropPress,release:this.onSelectDropRelease})},repositionDropdown:function(){var a,b,c,d=this.fakeElement.offset(),e=this.fakeElement[0].getBoundingClientRect(),f=e.width||e.right-e.left,g=this.fakeElement.outerHeight(),h=this.dropdown.css("width",f).outerHeight(),i=this.win.scrollTop(),j=this.win.height(),k=!1;d.top+g+h>i+j&&d.top-h>i&&(k=!0),this.options.fakeDropInBody&&(c="static"!==this.fakeDropTarget.css("position")?this.fakeDropTarget.offset().top:0,this.options.flipDropToFit&&k?(b=d.left,a=d.top-h-c):(b=d.left,a=d.top+g-c),this.dropdown.css({width:f,left:b,top:a})),this.dropdown.add(this.fakeElement).toggleClass(this.options.flipDropClass,this.options.flipDropToFit&&k)},showDropdown:function(){this.realElement.prop("options").length&&(this.dropdown||this.createDropdown(),this.dropActive=!0,this.dropdown.appendTo(this.fakeDropTarget),this.fakeElement.addClass(this.options.dropActiveClass),this.refreshSelectedText(),this.repositionDropdown(),this.list.setScrollTop(this.savedScrollTop),this.list.refresh(),this.win.on("resize",this.onResize),this.doc.on("jcf-pointerdown",this.onOutsideClick))},hideDropdown:function(){this.dropdown&&(this.savedScrollTop=this.list.getScrollTop(),this.fakeElement.removeClass(this.options.dropActiveClass+" "+this.options.flipDropClass),this.dropdown.removeClass(this.options.flipDropClass).detach(),this.doc.off("jcf-pointerdown",this.onOutsideClick),this.win.off("resize",this.onResize),this.dropActive=!1,"touch"===this.selectOpenedByEvent&&this.onBlur())},toggleDropdown:function(){this.dropActive?this.hideDropdown():this.showDropdown()},refreshSelectedText:function(){var a,c=this.realElement.prop("selectedIndex"),d=this.realElement.prop("options")[c],e=d?d.getAttribute("data-image"):null,f="",g=this;this.realElement.prop("multiple")?(b.each(this.realElement.prop("options"),function(a,b){b.selected&&(f+=(f?", ":"")+b.innerHTML)}),f||(f=g.realElement.attr("placeholder")||""),this.selectText.removeAttr("class").html(f)):d?(this.currentSelectedText!==d.innerHTML||this.currentSelectedImage!==e)&&(a=h(d.className,this.options.optionClassPrefix),this.selectText.attr("class",a).html(d.innerHTML),e?(this.selectImage||(this.selectImage=b("<img>").prependTo(this.selectTextContainer).hide()),this.selectImage.attr("src",e).show()):this.selectImage&&this.selectImage.hide(),this.currentSelectedText=d.innerHTML,this.currentSelectedImage=e):(this.selectImage&&this.selectImage.hide(),this.selectText.removeAttr("class").empty())},refresh:function(){"none"===this.realElement.prop("style").display?this.fakeElement.hide():this.fakeElement.show(),this.refreshSelectedText(),this.fakeElement.toggleClass(this.options.disabledClass,this.realElement.is(":disabled"))},destroy:function(){this.options.wrapNative?this.realElement.insertBefore(this.fakeElement).css({position:"",height:"",width:""}).removeClass(this.options.resetAppearanceClass):(this.realElement.removeClass(this.options.hiddenClass),this.realElement.is("[jcf-size]")&&this.realElement.removeAttr("size jcf-size")),this.fakeElement.remove(),this.doc.off("jcf-pointerup",this.onSelectAreaRelease),this.realElement.off({focus:this.onFocus})}}),b.extend(e.prototype,{init:function(){this.bindHandlers(),this.initStructure(),this.attachEvents()},initStructure:function(){this.realElement=b(this.options.element),this.fakeElement=b(this.options.fakeStructure).insertAfter(this.realElement),this.listHolder=this.fakeElement.find(this.options.listHolder),i(this.fakeElement),this.fakeElement.addClass(h(this.realElement.prop("className"),this.options.selectClassPrefix)),this.realElement.addClass(this.options.hiddenClass),this.list=new f({useCustomScroll:this.options.useCustomScroll,holder:this.listHolder,selectOnClick:!1,element:this.realElement})},attachEvents:function(){var a=this;this.delayedRefresh=function(b){b&&(16===b.which||b.ctrlKey||b.metaKey||b.altKey)||(clearTimeout(a.refreshTimer),a.refreshTimer=setTimeout(function(){a.refresh(),a.list.scrollToActiveOption()},1))},this.realElement.on({focus:this.onFocus,click:this.delayedRefresh,keydown:this.delayedRefresh}),b(this.list).on({select:this.onSelect,press:this.onFakeOptionsPress,release:this.onFakeOptionsRelease})},onFakeOptionsPress:function(a,b){this.pressedFlag=!0,"mouse"===b.pointerType&&this.realElement.focus()},onFakeOptionsRelease:function(a,b){this.pressedFlag=!1,"mouse"===b.pointerType&&this.realElement.focus()},onSelect:function(){this.fireNativeEvent(this.realElement,"change"),this.fireNativeEvent(this.realElement,"click")},onFocus:function(){this.pressedFlag&&this.focusedFlag||(this.fakeElement.addClass(this.options.focusClass),this.realElement.on("blur",this.onBlur),this.focusedFlag=!0)},onBlur:function(){this.pressedFlag||(this.fakeElement.removeClass(this.options.focusClass),this.realElement.off("blur",this.onBlur),this.focusedFlag=!1)},refresh:function(){this.fakeElement.toggleClass(this.options.disabledClass,this.realElement.is(":disabled")),this.list.refresh()},destroy:function(){this.list.destroy(),this.realElement.insertBefore(this.fakeElement).removeClass(this.options.hiddenClass),this.fakeElement.remove()}}),b.extend(f.prototype,{init:function(){this.initStructure(),this.refreshSelectedClass(),this.attachEvents()},initStructure:function(){this.element=b(this.options.element),this.indexSelector="["+this.options.indexAttribute+"]",this.container=b(this.options.containerStructure).appendTo(this.options.holder),this.listHolder=this.container.find(this.options.containerSelector),this.lastClickedIndex=this.element.prop("selectedIndex"),this.rebuildList(),this.element.prop("multiple")&&(this.previousSelection=this.getSelectedOptionsIndexes())},attachEvents:function(){this.bindHandlers(),this.listHolder.on("jcf-pointerdown",this.indexSelector,this.onItemPress),this.listHolder.on("jcf-pointerdown",this.onPress),this.options.useHoverClass&&this.listHolder.on("jcf-pointerover",this.indexSelector,this.onHoverItem)},onPress:function(a){b(this).trigger("press",a),this.listHolder.on("jcf-pointerup",this.onRelease)},onRelease:function(a){b(this).trigger("release",a),this.listHolder.off("jcf-pointerup",this.onRelease)},onHoverItem:function(a){var b=parseFloat(a.currentTarget.getAttribute(this.options.indexAttribute));this.fakeOptions.removeClass(this.options.hoverClass).eq(b).addClass(this.options.hoverClass)},onItemPress:function(a){"touch"===a.pointerType||this.options.selectOnClick?(this.tmpListOffsetTop=this.list.offset().top,this.listHolder.on("jcf-pointerup",this.indexSelector,this.onItemRelease)):this.onSelectItem(a)},onItemRelease:function(a){this.listHolder.off("jcf-pointerup",this.indexSelector,this.onItemRelease),this.tmpListOffsetTop===this.list.offset().top&&this.listHolder.on("click",this.indexSelector,{savedPointerType:a.pointerType},this.onSelectItem),delete this.tmpListOffsetTop},onSelectItem:function(a){var c,d=parseFloat(a.currentTarget.getAttribute(this.options.indexAttribute)),e=a.data&&a.data.savedPointerType||a.pointerType||"mouse";this.listHolder.off("click",this.indexSelector,this.onSelectItem),a.button>1||this.realOptions[d].disabled||(this.element.prop("multiple")?a.metaKey||a.ctrlKey||"touch"===e||this.options.multipleSelectWithoutKey?this.realOptions[d].selected=!this.realOptions[d].selected:a.shiftKey?(c=[this.lastClickedIndex,d].sort(function(a,b){return a-b}),this.realOptions.each(function(a,b){b.selected=a>=c[0]&&a<=c[1]})):this.element.prop("selectedIndex",d):this.element.prop("selectedIndex",d),a.shiftKey||(this.lastClickedIndex=d),this.refreshSelectedClass(),"mouse"===e&&this.scrollToActiveOption(),b(this).trigger("select"))},rebuildList:function(){var c=this,d=this.element[0];this.storedSelectHTML=d.innerHTML,this.optionIndex=0,this.list=b(this.createOptionsList(d)),this.listHolder.empty().append(this.list),this.realOptions=this.element.find("option"),this.fakeOptions=this.list.find(this.indexSelector),this.fakeListItems=this.list.find("."+this.options.captionClass+","+this.indexSelector),delete this.optionIndex;var e=this.options.maxVisibleItems,f=this.element.prop("size");f>1&&!this.element.is("[jcf-size]")&&(e=f);var g=this.fakeOptions.length>e;return this.container.toggleClass(this.options.scrollClass,g),g&&(this.listHolder.css({maxHeight:this.getOverflowHeight(e),overflow:"auto"}),this.options.useCustomScroll&&a.modules.Scrollable)?void a.replace(this.listHolder,"Scrollable",{handleResize:this.options.handleResize,alwaysPreventMouseWheel:this.options.alwaysPreventMouseWheel}):void(this.options.alwaysPreventMouseWheel&&(this.preventWheelHandler=function(a){var b=c.listHolder.scrollTop(),d=c.listHolder.prop("scrollHeight")-c.listHolder.innerHeight();(0>=b&&a.deltaY<0||b>=d&&a.deltaY>0)&&a.preventDefault()},this.listHolder.on("jcf-mousewheel",this.preventWheelHandler)))},refreshSelectedClass:function(){var a,b=this,c=this.element.prop("multiple"),d=this.element.prop("selectedIndex");c?this.realOptions.each(function(a,c){b.fakeOptions.eq(a).toggleClass(b.options.selectedClass,!!c.selected)}):(this.fakeOptions.removeClass(this.options.selectedClass+" "+this.options.hoverClass),a=this.fakeOptions.eq(d).addClass(this.options.selectedClass),this.options.useHoverClass&&a.addClass(this.options.hoverClass))},scrollToActiveOption:function(){var a=this.getActiveOptionOffset();"number"==typeof a&&this.listHolder.prop("scrollTop",a)},getSelectedOptionsIndexes:function(){var a=[];return this.realOptions.each(function(b,c){c.selected&&a.push(b)}),a},getChangedSelectedIndex:function(){var a=this.element.prop("selectedIndex"),c=this,d=!1,e=null;return this.element.prop("multiple")?(this.currentSelection=this.getSelectedOptionsIndexes(),b.each(this.currentSelection,function(a,b){!d&&c.previousSelection.indexOf(b)<0&&(0===a&&(d=!0),e=b)}),this.previousSelection=this.currentSelection,e):a},getActiveOptionOffset:function(){var a=this.getChangedSelectedIndex();if(null!==a){var b=this.listHolder.height(),c=this.listHolder.prop("scrollTop"),d=this.fakeOptions.eq(a),e=d.offset().top-this.list.offset().top,f=d.innerHeight();return e+f>=c+b?e-b+f:c>e?e:void 0}},getOverflowHeight:function(a){var b=this.fakeListItems.eq(a-1),c=this.list.offset().top,d=b.offset().top,e=b.innerHeight();return d+e-c},getScrollTop:function(){return this.listHolder.scrollTop()},setScrollTop:function(a){this.listHolder.scrollTop(a)},createOption:function(a){var b=document.createElement("span");b.className=this.options.optionClass,b.innerHTML=a.innerHTML,b.setAttribute(this.options.indexAttribute,this.optionIndex++);var c,d=a.getAttribute("data-image");return d&&(c=document.createElement("img"),c.src=d,b.insertBefore(c,b.childNodes[0])),a.disabled&&(b.className+=" "+this.options.disabledClass),a.className&&(b.className+=" "+h(a.className,this.options.cloneClassPrefix)),b},createOptGroup:function(a){var b,c,d=document.createElement("span"),e=a.getAttribute("label");return b=document.createElement("span"),b.className=this.options.captionClass,b.innerHTML=e,d.appendChild(b),a.children.length&&(c=this.createOptionsList(a),d.appendChild(c)),d.className=this.options.groupClass,d},createOptionContainer:function(){var a=document.createElement("li");return a},createOptionsList:function(a){var c=this,d=document.createElement("ul");return b.each(a.children,function(a,b){var e,f=c.createOptionContainer(b);switch(b.tagName.toLowerCase()){case"option":e=c.createOption(b);break;case"optgroup":e=c.createOptGroup(b)}d.appendChild(f).appendChild(e)}),d},refresh:function(){this.storedSelectHTML!==this.element.prop("innerHTML")&&this.rebuildList();var b=a.getInstance(this.listHolder);b&&b.refresh(),this.refreshSelectedClass()},destroy:function(){this.listHolder.off("jcf-mousewheel",this.preventWheelHandler),this.listHolder.off("jcf-pointerdown",this.indexSelector,this.onSelectItem),this.listHolder.off("jcf-pointerover",this.indexSelector,this.onHoverItem),this.listHolder.off("jcf-pointerdown",this.onPress)}});var h=function(a,b){return a?a.replace(/[\s]*([\S]+)+[\s]*/gi,b+"$1 "):""},i=function(){function b(a){a.preventDefault()}var c=a.getOptions().unselectableClass;return function(a){a.addClass(c).on("selectstart",b)}}();return g})}(jcf);